<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visual Debugger</title>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style type="text/css">
      html,
      body,
      #visjs-network {
        width: 100%;
        height: 100%;
        padding: 0;
      }
    </style>
  </head>

  <body>
    <div id="visjs-network"></div>
    <script type="text/javascript">
      let network;
      let edges;
      let nodes;
      let defaultNodeColor;
      let defaultEdgeColor;

      window.addEventListener('message', (event) => {
        const message = event.data;

        if (message.command === 'initializeVisjs') {
          const container = document.querySelector('#visjs-network');
          edges = new vis.DataSet(message.data.edges);
          nodes = new vis.DataSet(message.data.nodes);
          defaultNodeColor = message.options.nodes.color;
          defaultEdgeColor = message.options.edges.color;

          const data = { edges, nodes };
          network = new vis.Network(container, data, message.options);
        } else if (message.command === 'updateVisjs') {
          edges.remove(message.data.deleteEdgeIds);
          nodes.remove(message.data.deleteNodeIds);

          nodes.updateOnly(nodes.map((node) => ({ ...node, color: defaultNodeColor })));
          edges.updateOnly(edges.map((edge) => ({ ...edge, color: defaultEdgeColor })));

          nodes.add(message.data.addNodes);
          nodes.updateOnly(message.data.updateNodes);
          edges.add(message.data.addEdges);
        } else if (message.command === 'exportVisjs') {
          const canvas = document.querySelector('#visjs-network canvas');
          const img = canvas.toDataURL('image/png');
          var downloadLink = document.createElement('a');
          downloadLink.download = 'export.png';
          downloadLink.href = img;
          downloadLink.click();
        }
      });
    </script>
  </body>
</html>
